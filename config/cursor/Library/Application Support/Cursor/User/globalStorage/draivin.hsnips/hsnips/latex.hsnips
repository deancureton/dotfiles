global
function math(context) {
    return context.scopes.findLastIndex(s => s.startsWith("meta.math")) > context.scopes.findLastIndex(s => s.startsWith("comment") || s.startsWith("meta.text.normal.tex"));
}
function notmath(context) {
    return context.scopes.findLastIndex(s => s.startsWith("meta.math")) <= context.scopes.findLastIndex(s => s.startsWith("comment") || s.startsWith("meta.text.normal.tex"));
}
endglobal

context notmath(context)
snippet `mk` "Inline math mode" A
$$1$
endsnippet

context notmath(context)
snippet `dm` "Display math mode" A
\\[
$1
\\]
endsnippet

priority -1
context math(context)
snippet `im` "image" A
\\im 
endsnippet

priority -1
context math(context)
snippet `int` "integral" A
\\int 
endsnippet

snippet `box` "Box" A
``rv = '┌' + '─'.repeat(t[0].length + 2) + '┐'``
│ $1 │
``rv = '└' + '─'.repeat(t[0].length + 2) + '┘'``

endsnippet

context notmath(context)
snippet `table([1-9]{1}) ([1-9]{1})` "Table environment" Ab
\\begin{table}[H]
	\\centering
	\\begin{tabular}{``let len = m[2]; let results = ""; for(var i=0; i<len-1; i++){ results += "c|"} results += "c"; rv = results;``}
	    \\toprule
			``let order = 1; nrow = m[1]; ncol = m[2]; for (var i=0; i<nrow-1; i++){ for(var j = 0;j <ncol-1;j++){ rv += `${snip.tabstop(order+3)} & `; order ++;}	rv += ` ${snip.tabstop(order+3)} \\\\\\\\`+ `\\\\`+ `\\n`; order ++; if(i == 0){ rv += `		\\\\midrule` + `\\n`; } rv += `			`; }	for(var j = 0;j <ncol-1;j++){ rv += `${snip.tabstop(order+3)} & `; order ++;} rv += ` ${snip.tabstop(order+3)} \\\\\\\\` + `\\\\`;``
    	\\bottomrule
	\\end{tabular}
	\\caption{${2:caption}}
	\\label{tab:${3:label}}
\\end{table}

endsnippet

context math(context)
snippet `ary([1-9]{1}) ([1-9]{1})` "Array environment" Aib
\\begin{array}{``let len = m[2]; let results = ""; for(var i=0; i<len; i++){ results += "c"} rv = results;``}
``let order = 1; let nrow = m[1]; let ncol = m[2]; for (var i=0; i<nrow-1; i++){ for(var j = 0;j <ncol-1;j++){ rv += `${snip.tabstop(order)} & `; order ++;} rv += ` ${snip.tabstop(order)} \\\\\\\\`+ `\\\\`+ `\\n` + `	`; order ++;} for(var j = 0;j <ncol-1;j++){ rv += `${snip.tabstop(order)} & `; order ++;} rv += ` ${snip.tabstop(order)} \\\\\\\\`+ `\\\\`;``
\\end{array}

endsnippet

priority 2000
context math(context)
snippet `(b|p)mat([1-9]{1}) ([1-9]{1})` "Matrix environment (bmatrix or pmatrix)" Aiw
\\begin{``rv = m[1]``matrix}``
let order = 1;
let nrow = m[2];
let ncol = m[3];
rv = `\\n`;
for (var i=0; i<nrow; i++){
	rv += '	';
	for(var j = 0;j <ncol-1;j++){
		rv += `${snip.tabstop(order)} & `;
		order ++;
	}
	rv += ` ${snip.tabstop(order)} \\\\\\\\`+ `\\\\`+ `\\n`;
	order ++;
}
``\\end{``rv = m[1]``matrix}$0

endsnippet

context math(context)
snippet `vec([1-9])` "Column vector" A
\\begin{pmatrix}
``msg = snip.tabstop(1); for (i = 1; i < parseInt(m[1],10); i++) { msg += ' \\\\\\\\\\\\ \\n' + snip.tabstop(count + 1); count++; } rv = msg;``
\\end{pmatrix}$0

endsnippet

context math(context)
snippet `((\d+)|(\d*)(\\)?([A-Za-z]+)((\^|_)(\{\d+\}|\d))*)/` "Fraction (no parentheses)" A
\\frac{``rv = m[1]``}{$1}$0
endsnippet

context math(context)
snippet `^.*\)/` "Fraction with parentheses" A
``let str = m[0]; str = str.slice(0, -1); let lastIndex = str.length - 1; let depth = 0; let i = str.length - 1; while (true) { if (str[i] == ')') depth += 1; if (str[i] == '(') depth -= 1; if (depth == 0) break; i -= 1; } let results = str.slice(0, i) + "\\\\frac{" + str.slice(i+1, -1) + "}"; rv = results;``
{$1}$0

endsnippet

context math(context)
snippet `([a-zA-Z]+)([0-9]+) ` "Underset" A
``if ( m[2].length == 1 ) { a = '_'; b = ' '; } else { a = '_{'; b = '} '; } if (m[1] == "pmat" || m[1] == "bmat" || m[1] == "ary") { rv = m[1] + m[2] + ' ' } else { rv = m[1] + a + m[2] + b }``

endsnippet

context math(context)
snippet `(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint|to|pm|mp)` "Greek letter, symbol, or short symbol" A
\\``rv = m[1]``
endsnippet

context math(context)
snippet `@a` "alpha" A
\\alpha
endsnippet

context math(context)
snippet `@A` "Alpha" A
\\alpha
endsnippet

context math(context)
snippet `@b` "beta" A
\\beta
endsnippet

context math(context)
snippet `@B` "Beta" A
\\beta
endsnippet

context math(context)
snippet `@g` "gamma" A
\\gamma
endsnippet

context math(context)
snippet `@G` "Gamma" A
\\Gamma
endsnippet

context math(context)
snippet `@d` "delta" A
\\delta
endsnippet

context math(context)
snippet `@D` "Delta" A
\\Delta
endsnippet

context math(context)
snippet `@e` "epsilon" A
\\epsilon
endsnippet

context math(context)
snippet `@E` "Epsilon" A
\\epsilon
endsnippet

context math(context)
snippet `:e` "varepsilon" A
\\varepsilon
endsnippet

context math(context)
snippet `:E` "Varepsilon" A
\\varepsilon
endsnippet

context math(context)
snippet `@z` "zeta" A
\\zeta
endsnippet

context math(context)
snippet `@Z` "Zeta" A
\\zeta
endsnippet

context math(context)
snippet `@h` "eta" A
\\eta
endsnippet

context math(context)
snippet `@t` "theta" A
\\theta
endsnippet

context math(context)
snippet `@T` "Theta" A
\\Theta
endsnippet

context math(context)
snippet `@i` "iota" A
\\iota
endsnippet

context math(context)
snippet `@k` "kappa" A
\\kappa
endsnippet

context math(context)
snippet `@K` "Kappa" A
\\kappa
endsnippet

context math(context)
snippet `@l` "lambda" A
\\lambda
endsnippet

context math(context)
snippet `@L` "Lambda" A
\\Lambda
endsnippet

context math(context)
snippet `@m` "mu" A
\\mu
endsnippet

context math(context)
snippet `@M` "Mu" A
\\mu
endsnippet

context math(context)
snippet `@n` "nu" A
\\nu
endsnippet

context math(context)
snippet `@x` "xi" A
\\xi
endsnippet

context math(context)
snippet `@X` "Xi" A
\\Xi
endsnippet

context math(context)
snippet `@p` "pi" A
\\pi
endsnippet

context math(context)
snippet `@P` "Pi" A
\\Pi
endsnippet

context math(context)
snippet `@r` "rho" A
\\rho
endsnippet

context math(context)
snippet `@R` "Rho" A
\\rho
endsnippet

context math(context)
snippet `@s` "sigma" A
\\sigma
endsnippet

context math(context)
snippet `@S` "Sigma" A
\\Sigma
endsnippet

context math(context)
snippet `@u` "tau" A
\\tau
endsnippet

context math(context)
snippet `@y` "upsilon" A
\\upsilon
endsnippet

context math(context)
snippet `@Y` "Upsilon" A
\\Upsilon
endsnippet

context math(context)
snippet `@f` "phi" A
\\phi
endsnippet

context math(context)
snippet `@F` "Phi" A
\\phi
endsnippet

context math(context)
snippet `:f` "varphi" A
\\varphi
endsnippet

context math(context)
snippet `:F` "Varphi" A
\\varphi
endsnippet

context math(context)
snippet `@v` "psi" A
\\psi
endsnippet

context math(context)
snippet `@V` "Psi" A
\\Psi
endsnippet

context math(context)
snippet `@c` "chi" A
\\chi
endsnippet

context math(context)
snippet `@C` "Chi" A
\\chi
endsnippet

context math(context)
snippet `@o` "omega" A
\\omega
endsnippet

context math(context)
snippet `@O` "Omega" A
\\Omega
endsnippet

context math(context)
snippet `ome` "omega" A
\\omega
endsnippet

context math(context)
snippet `([^\\])(arcsin|arccos|arctan|arccot|arccsc|arcsec|sin|cos|tan|cot|csc|sec)` "Trigonometric function" A
``rv = m[1] + '\\'  + m[2]``
endsnippet

context math(context)
snippet `\\(arcsin|arccos|arctan|arccot|arccsc|arcsec|sin|cos|tan|cot|csc|sec)([A-Za-gi-z])` "Space after trigonometric functions" A
``rv = '\\' + m[1] + ' ' + m[2]``
endsnippet

context math(context)
snippet `\\(arcsinh|arccosh|arctanh|arccoth|arcsch|arcsech|sinh|cosh|tanh|coth|csch|sech)([A-Za-z])` "Space after hyperbolic trigonometric functions" A
``rv = '\\' + m[1] + ' ' + m[2]``
endsnippet

context math(context)
snippet `\\(neq|geq|leq|gg|ll|sim)([0-9]+)` "Inequality" A
``rv = '\\' + m[1] + ' ' + m[2]``
endsnippet

context math(context)
snippet `(CC|RR|QQ|ZZ|NN|FF|EE|PP)` "Common mathematical letter symbols" A
``rv = '\\' + m[1]``
endsnippet

context math(context)
snippet `II` "II" A
\\mathbb{1}
endsnippet

context math(context)
snippet `\\mathbb{1}I` "III" A
\\hat{\\mathbb{1}}
endsnippet

context math(context)
snippet `Fp` "F_p" A
\\FF_p
endsnippet

context math(context)
snippet `Fq` "F_q" A
\\FF_q
endsnippet

context math(context)
snippet `Rn` "R^n" A
\\RR^n
endsnippet

context math(context)
snippet `lll` "ell" A
\\ell
endsnippet

context math(context)
snippet `([A-Z])#` "Boldface" A
``rv = '\\mathbb{' + m[1] + '}'``
endsnippet

context math(context)
snippet `\.\.` "ellipsis" A
\\ldots
endsnippet

context math(context)
snippet `\\ldots\.` "ellipsis with period" A
\\cdots
endsnippet

context math(context)
snippet `ooo` "infinity" A
\\infty
endsnippet

context math(context)
snippet `\+-` "plus or minus" A
\\pm
endsnippet

context math(context)
snippet `-\+` "minus or plus" A
\\mp
endsnippet

context math(context)
snippet `([^\\])pm` "plus or minus" 
``rv = m[1]``\\pm
endsnippet

context math(context)
snippet `([^\\])mp` "minus or plus" 
``rv = m[1]``\\mp
endsnippet

context math(context)
snippet `xx` "times" A
\\times
endsnippet

context math(context)
snippet `sq` "square root" A
\\sqrt{ $1 }$2
endsnippet

context math(context)
snippet `<->` "leftrightarrow" A
\\leftrightarrow
endsnippet

context math(context)
snippet `->` "to" A
\\to
endsnippet

context math(context)
snippet `!>` "maps to" A
\\mapsto
endsnippet

context math(context)
snippet `=>` "implies" A
\\implies
endsnippet

context math(context)
snippet `=<` "impliedby" A
\\impliedby
endsnippet

context math(context)
snippet `\\\\\\` "setminus" A
\\setminus
endsnippet

context math(context)
snippet `\|\|` "mid" A
\\mid
endsnippet

context math(context)
snippet `and` "intersection" A
\\cap
endsnippet

context math(context)
snippet `orr` "union" A
\\cup
endsnippet

context math(context)
snippet `inn` "in" A
\\in
endsnippet

context math(context)
snippet `notin` "not in" A
\\notin
endsnippet

context math(context)
snippet `\\subset eq` "subseteq" A
\\subseteq
endsnippet

context math(context)
snippet `\\supset eq` "supseteq" A
\\supseteq
endsnippet

context math(context)
snippet `eset` "empty set" A
\\varnothing
endsnippet

context math(context)
snippet `set` "set" A
\\{ $1 \\}$2
endsnippet

context math(context)
snippet `e\\xi sts` "exists" A
\\exists
endsnippet

context math(context)
snippet `===` "equivalent" A
\\equiv
endsnippet

context math(context)
snippet `Sq` "square" A
\\square
endsnippet

context math(context)
snippet `!=` "not equal" A
\\neq
endsnippet

context math(context)
snippet `>=` "greater than or equal to" A
\\geq
endsnippet

context math(context)
snippet `<=` "less than or equal to" A
\\leq
endsnippet

context math(context)
snippet `>>` "greater than" A
\\gg
endsnippet

context math(context)
snippet `<<` "less than" A
\\ll
endsnippet

context math(context)
snippet `~~` "similar to" A
\\sim
endsnippet

context math(context)
snippet `\\sim ~` "approx" A
\\approx
endsnippet

context math(context)
snippet `\/\/` "fraction" A
\\frac{$1}{$2}$3
endsnippet

context math(context)
snippet `prop` "proportional to" A
\\propto
endsnippet

context math(context)
snippet `(nabl|del)` "nabla" A
\\nabla
endsnippet

context math(context)
snippet `\*\*` "dot" A
\\cdot
endsnippet

context math(context)
snippet `para` "parallel" A
\\parallel
endsnippet

context math(context)
snippet `\\pi tchfork` "pitchfork" A
\\pitchfork
endsnippet

context math(context)
snippet `bu\\ll et` "bullet" A
\\bullet
endsnippet

context math(context)
snippet `trace` "trace" A
\\tr
endsnippet

context math(context)
snippet `lim` "limit" A
\\lim_{ ${1:n} \\to ${2:\\infty} } $3
endsnippet

context math(context)
snippet `linf` "liminf" A
\\liminf_{ ${1:n} \\to ${2:\\infty} } $3
endsnippet

context math(context)
snippet `lsup` "limsup" A
\\limsup_{ ${1:n} \\to ${2:\\infty} } $3
endsnippet

context math(context)
snippet `o\+` "oplus" A
\\oplus
endsnippet

context math(context)
snippet `ox` "otimes" A
\\otimes
endsnippet

context math(context)
snippet `ot\\imes` "otimes" A
\\otimes
endsnippet

context math(context)
snippet `\\cdot ss` "cdots" A
\\cdots
endsnippet

context math(context)
snippet `sr` "square" A
^{2}
endsnippet

context math(context)
snippet `cb` "cube" A
^{3}
endsnippet

context math(context)
snippet `rd` "superscript" A
^{$1}$2
endsnippet

context math(context)
snippet `invs` "inverse" A
^{-1}
endsnippet

context math(context)
snippet `ee` "exponential" A
e^{$1}$2
endsnippet

context math(context)
snippet `conj` "conjugate" A
^{*}
endsnippet

context math(context)
snippet `sts` "subscript" A
_\\text{$1}
endsnippet

context math(context)
snippet `_` "subscript" A
_{$1}$2
endsnippet

context math(context)
snippet `([A-Za-z])(\d)` "Auto letter subscript" A
``rv = m[1] + '_{' + m[2] + '}'``
endsnippet

context math(context)
snippet `([A-Za-z])_(\d\d)` "Auto letter subscript" A
``rv = m[1] + '_{' + m[2] + '}'``
endsnippet

context math(context)
snippet `\\hat{([A-Za-z])}(\d)` "Auto letter subscript" A
``rv = '\\hat{' + m[1] + '}_{' + m[2] + '}'``
endsnippet

context math(context)
snippet `\\mathbf{([A-Za-z])}(\d)` "Auto letter subscript" A
``rv = '\\mathbf{' + m[1] + '}_{' + m[2] + '}'``
endsnippet

context math(context)
snippet `\\vec{([A-Za-z])}(\d)` "Auto letter subscript" A
``rv = '\\vec{' + m[1] + '}_{' + m[2] + '}'``
endsnippet

context math(context)
snippet `([a-zA-Z0-9])td` "Exponentiation" 
``rv = m[1] + '^{' + snip.tabstop(1) + '}'``
endsnippet

context math(context)
snippet `\b(d|D)(\\?\w+)[dD](\w{1}|\\\w+) ` "Derivatives" A
``
if (m[1] == 'd') 
  rv = '\\\\frac{\\\\partial ' + m[2] + '}{\\\\partial ' + m[3] + '}';
else 
  rv = '\\\\frac{\\\\mathrm{d}' + m[2] + '}{\\\\mathrm{d}' + m[3] + '}';
``

endsnippet

context math(context)
snippet `lr\|` "Left and right vertical bars" A
\\left| $1 \\right|$2
endsnippet

context math(context)
snippet `lra` "Left and right angle brackets" A
\\left< $1 \\right>$2
endsnippet

context math(context)
snippet `avg` "Average" A
\\langle $1 \\rangle $2
endsnippet

context math(context)
snippet `norm` "norm" A
\\lvert $1 \\rvert $2
endsnippet

context math(context)
snippet `Norm` "Norm" A
\\lVert $1 \\rVert $2
endsnippet

context math(context)
snippet `ceil` "ceil" A
\\lceil $1 \\rceil $2
endsnippet

context math(context)
snippet `floor` "floor" A
\\lfloor $1 \\rfloor $2
endsnippet

context math(context)
snippet `mod` "mod" A
\\pmod{1}$2
endsnippet

context math(context)
snippet `pmod` "pmod" A
\\pmod{1}$2
endsnippet

context math(context)
snippet `bmod` "bmod" A
\\bmod{1}$2
endsnippet

context math(context)
snippet `text` "Text" A
\\text{$1}$2
endsnippet

context math(context)
snippet `rm` "Roman" A
\\mathrm{$1}$2
endsnippet

context math(context)
snippet `bf` "Boldface" A
\\mathbf{$1}$2
endsnippet

context math(context)
snippet `bb` "Blackboard bold" A
\\mathbb{$1}$2
endsnippet

context math(context)
snippet `mcal` "Caligraphic" A
\\mathcal{$1}$2
endsnippet

context math(context)
snippet `sf` "Sans-serif" A
\\mathsf{$1}$2
endsnippet

context math(context)
snippet `frak` "Fraktur" A
\\mathfrak{$1}$2
endsnippet

context math(context)
snippet `oname` "Operator name" A
\\operatorname{$1}$2
endsnippet

priority 1
context math(context)
snippet `\b([a-zA-Z])frak\b` "Fraktur" A
\\mathfrak{``rv = m[1]``}
endsnippet

context math(context)
snippet `\b([a-zA-Z])cal\b` "Caligraphic" A
\\mathcal{``rv = m[1]``}
endsnippet

context math(context)
snippet `([a-zA-Z]),\.` "Boldface" A
\\mathbf{``rv = m[1]``}
endsnippet

context math(context)
snippet `([a-zA-Z])\.,` "Boldface" A
\\mathbf{``rv = m[1]``}
endsnippet

context math(context)
snippet `(bar|hat|vec|tilde)` "diacritic" A
\\``rv = m[1]``{$1}$2
endsnippet

context math(context)
snippet `dot` "dot" 
\\dot{$1}$2
endsnippet

context math(context)
snippet `und` "underline" A
\\underline{$1}$2
endsnippet

context math(context)
snippet `ovr` "overline" A
\\overline{$1}$2
endsnippet

context math(context)
snippet `([a-zA-Z])(bar|hat|ddot|vec|tilde)` "diacritic" A
\\``rv = m[2]``{``rv = m[1]``}
endsnippet

context math(context)
snippet `([a-zA-Z])dot` "dot" 
\\dot{``rv = m[1]``}
endsnippet

context math(context)
snippet `([a-zA-Z])und` "underline" A
\\underline{``rv = m[1]``}
endsnippet

context math(context)
snippet `([a-zA-Z])ovr` "overline" A
\\overline{``rv = m[1]``}
endsnippet

context math(context)
snippet `par` "Partial derivative" 
\\frac{ \\partial ${1:y} }{ \\partial ${2:x} } $3
endsnippet

context math(context)
snippet `pa2` "Second partial derivative" A
\\frac{ \\partial^{2} ${1:y} }{ \\partial ${2:x}^{2} } $3
endsnippet

context math(context)
snippet `pa3` "Third partial derivative" A
\\frac{ \\partial^{3} ${1:y} }{ \\partial ${2:x}^{3} } $3
endsnippet

context math(context)
snippet `pa([A-Za-z])([A-Za-z])` "Partial derivative" 
\\frac{ \\partial ``rv = m[1]`` }{ \\partial ``rv = m[2]`` } 
endsnippet

context math(context)
snippet `pa([A-Za-z])([A-Za-z])([A-Za-z])` "Second partial derivative" A
\\frac{ \\partial^{2} ``rv = m[1]`` }{ \\partial ``rv = m[2]``^{2} } 
endsnippet

context math(context)
snippet `pa([A-Za-z])([A-Za-z])2` "Second partial derivative" A
\\frac{ \\partial^{2} ``rv = m[1]`` }{ \\partial ``rv = m[2]``^{2} } 
endsnippet

context math(context)
snippet `de([A-Za-z])([A-Za-z])` "Derivative" 
\\frac{ d``rv = m[1]`` }{ d``rv = m[2]`` } 
endsnippet

context math(context)
snippet `de([A-Za-z])([A-Za-z])2` "Second derivative" A
\\frac{ d^{2}``rv = m[1]`` }{ d``rv = m[2]``^{2} } 
endsnippet

context math(context)
snippet `ddx` "Derivative wrt x" A
\\frac{d}{dx}
endsnippet

context math(context)
snippet `ddy` "Derivative wrt y" A
\\frac{d}{dy}
endsnippet

context math(context)
snippet `ddt` "Derivative wrt t" A
\\frac{d}{dt}
endsnippet

context math(context)
snippet `oinf` "Integral from 0 to infinity" A
\\int_{0}^{\\infty} $1 \\, d${2:x} $3
endsnippet

context math(context)
snippet `infi` "Integral from negative infinity to infinity" A
\\int_{-\\infty}^{\\infty} $1 \\, d${2:x} $3
endsnippet

context math(context)
snippet `dint` "Integral from 0 to infinity" A
\\int_{${1:0}}^{${2:\\infty}} $3 \\, d${4:x} $5
endsnippet

context math(context)
snippet `fx` "Function" A
f(x)
endsnippet

context math(context)
snippet `ff` "Function" A
f($1)
endsnippet

context math(context)
snippet `xnn` "x_n" A
x_{n}
endsnippet

context math(context)
snippet `xii` "x_i" A
x_{i}
endsnippet

context math(context)
snippet `\\xi i` "x_i" A
x_{i} alternate
endsnippet

context math(context)
snippet `xjj` "x_j" A
x_{j}
endsnippet

context math(context)
snippet `xp1` "x_{n+1}" A
x_{n+1}
endsnippet

context math(context)
snippet `ynn` "y_n" A
y_{n}
endsnippet

context math(context)
snippet `yii` "y_i" A
y_{i}
endsnippet

context math(context)
snippet `yjj` "y_j" A
y_{j}
endsnippet

context math(context)
snippet `:(i|j|k)` "Unit vector (i, j, k)" A
``rv = '\\mathbf{' + m[1] + '}'``
endsnippet

context math(context)
snippet `:(x|y|z)` "Unit vector (x, y, z)" A
``rv = '\\hat{\\mathbf{' + m[1] + '}}'``
endsnippet

context math(context)
snippet `kbt` "k_B T" A
k_{B} T
endsnippet

context math(context)
snippet `hba` "hbar" A
\\hbar
endsnippet

context math(context)
snippet `dag` "dagger" A
^{\\dagger}
endsnippet

context math(context)
snippet `bra` "bra" A
\\bra{$1} $2
endsnippet

context math(context)
snippet `ket` "ket" A
\\ket{$1} $2
endsnippet

context math(context)
snippet `brk` "braket" A
\\braket{ $1 | $2 } $3
endsnippet

context math(context)
snippet `\\bra{([^|]+)\|` "Convert bra into braket" A
\\braket{ ``rv = m[1]`` | $1 
endsnippet

context math(context)
snippet `\\bra{(.+)}([^ ]+)>` "Convert bra into braket" A
\\braket{ ``rv = m[1]`` | $1 
endsnippet

context math(context)
snippet `outp` "output" A
\\ket{${1:\\psi}} \\bra{${1:\\psi}} $2
endsnippet

context math(context)
snippet `pu` "physical units" A
\\pu{ $1 }
endsnippet

context math(context)
snippet `(msun|solm)` "solar mass" A
M_{\\odot}
endsnippet

context math(context)
snippet `cee` "chemical formula" A
\\ce{ $1 }
endsnippet

context math(context)
snippet `iso` "isotope" A
{}^{${1:4}}_{${2:2}}${3:He}
endsnippet

context math(context)
snippet `hel4` "helium" A
{}^{4}_{2}He
endsnippet

context math(context)
snippet `hel3` "helium" A
{}^{3}_{2}He
endsnippet

context math(context)
snippet `([^\\])(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint)` "Add backslash before greek letters and symbols" A
``rv = m[1] + '\\' + m[2]``
endsnippet

priority 1
context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint|to|pm|mp)([A-Za-z])` "Insert space after greek letters and symbols" A
``rv = '\\' + m[1] + ' ' + m[2]``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint) sr` "Superscript 2 after greek letters and symbols" A
``rv = '\\' + m[1] + '^{2}'``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint) cb` "Superscript 3 after greek letters and symbols" A
``rv = '\\' + m[1] + '^{3}'``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint) rd` "Superscript arbitrary after greek letters and symbols" A
``rv = '\\' + m[1] + '^{$1}$2'``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint) (hat|bar|vec|tilde)` "Diacritic over greek letters and symbols" A
``rv = '\\' + m[2] + '{' + m[1] + '}'``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint) dot` "Diacritic over greek letters and symbols" 
``rv = '\\dot{' + m[1] + '}'``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint) und` "Underline greek letters and symbols" A
``rv = '\\underline{' + m[1] + '}'``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega|cdot|cdots|sum|prod|cap|cup|iff|ell|mid|subset|supset|notin|sim|hbar|infty|leftrightarrow|mapsto|setminus|bigcap|bigcup|land|lor|subseteq|supseteq|implies|impliedby|exists|forall|equiv|square|neq|geq|leq|gg|ll|simeq|approx|propto|oplus|otimes|times|star|perp|det|adj|exp|ln|log|partial|circ|deg|wedge|langle|rangle|cong|max|min|nabla|Gal|Aut|Hom|ker|Im|Re|dim|deg|wedge|langle|rangle|cong|codim|vdots|ddots|oint|iint|iiint) ovr` "Overline greek letters and symbols" A
``rv = '\\overline{' + m[1] + '}'``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega),\.` "Bold greek letter (comma dot)" A
``rv = '\\boldsymbol{' + m[1] + '}'``
endsnippet

context math(context)
snippet `\\(alpha|beta|gamma|Gamma|delta|Delta|epsilon|varepsilon|zeta|eta|theta|Theta|iota|kappa|lambda|Lambda|mu|nu|omicron|xi|Xi|pi|Pi|rho|sigma|Sigma|tau|upsilon|Upsilon|varphi|phi|Phi|chi|psi|Psi|omega|Omega)\.,` "Bold greek letter (dot comma)" A
``rv = '\\boldsymbol{' + m[1] + '}'``
endsnippet

